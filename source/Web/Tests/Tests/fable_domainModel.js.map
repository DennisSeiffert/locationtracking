{"version":3,"sources":["../fable_domainModel.fsx"],"names":[],"mappings":"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","file":"fable_domainModel.js","sourcesContent":["open System\n\ntype TrackingJob = {\n    identifier : string;\n    marker : string;\n    subscription : string;\n    latitude : double;\n    longitude : double;\n    utcTimestamp : DateTime;\n    updatePositionOnMap : bool;\n    observe : bool; \n}\n\ntype Track = {\n    mintimestamp : DateTime;\n    maxtimestamp : DateTime;\n    name : string;\n}\n\ntype TrackingPoint = {\n   latitude : double;\n   longitude : double;\n   timestamputc : DateTime;\n   speed : double;\n   distanceCovered : double;\n   distance : double;\n   index : int;\n   elevation : double;      \n}\n\nlet toRad x =\n    x * Math.PI / 180.0\n\nlet distance lat1 lon1 lat2 lon2 =\n    let R = 6371.0 // Radius of the earth in km\n    let dLat = toRad(lat2 - lat1)  // Javascript functions in radians\n    let dLon = toRad(lon2 - lon1)\n    let a = Math.Sin(dLat / 2.0) * Math.Sin(dLat / 2.0) +\n            Math.Cos(toRad(lat1)) * Math.Cos(toRad(lat2)) *\n            Math.Sin(dLon / 2.0) * Math.Sin(dLon / 2.0)\n    let c = 2.0 * Math.Atan2(Math.Sqrt(a), Math.Sqrt(1.0 - a))\n    let d = R * c // Distance in km\n    d * 1000.0\n\n\ntype TrackVisualization(name : string, points : TrackingPoint List) =         \n    member this.Points = points     \n    member this.TrackName = name\n\n    member this.totalDistanceInMeters () = \n        this.Points.[this.Points.Length - 1].distanceCovered;\n\n    member this.getIndexOfNearestPoint (distanceInMeters) =   \n        this.Points |> List.findIndex (fun (p) -> p.distanceCovered >= distanceInMeters)\n\n    member this.getGeoPointFromElevationDataIndex (index : int) =\n        let meters = (double index / double this.Points.Length) * this.totalDistanceInMeters();\n        let markerPointIndex = this.getIndexOfNearestPoint(meters);\n        let geoPoint = this.getPointAt(markerPointIndex);\n        geoPoint;\n  \n\n    member this.getPointAt index =\n        this.Points.[index]    \n\n    static member  calculate points =\n        points\n        |> List.mapi (fun i p ->\n                        match i with\n                        | 0 -> {p with speed = 0.0; distanceCovered = 0.0; index = i }\n                        | _ ->  \n                            let distanceBetween = distance points.[i - 1].latitude points.[i - 1].longitude p.latitude p.longitude\n                            let timespan = p.timestamputc - points.[i - 1].timestamputc\n                            let speed = if timespan > TimeSpan.Zero then\n                                            distanceBetween / (timespan.TotalMilliseconds / 1000.0)\n                                        else \n                                            0.0                                        \n                            {p with\n                                speed = speed\n                                distance = distanceBetween\n                                distanceCovered = points.[i - 1].distance + distanceBetween\n                                index = i\n                            }\n                       )                             \n     \n\n\ntype TrackingService() = \n    member val ownTrackingJob = {            \n            identifier = String.Empty;\n            marker = String.Empty;\n            subscription = String.Empty;\n            latitude = 0.0;\n            longitude = 0.0;\n            utcTimestamp = DateTime.UtcNow;\n            updatePositionOnMap = true;\n            observe = true;}\n    member val observedTrackingJobs : TrackingJob List = List.Empty with get, set    \n    \n    member this.CreateTrackingJob(name, latitude, longitude) =\n        {            \n            identifier = name;\n            marker = String.Empty;\n            subscription = String.Empty;\n            latitude = latitude;\n            longitude = longitude;\n            utcTimestamp = DateTime.UtcNow;\n            updatePositionOnMap = true;\n            observe = true;        \n        }\n    \n    member this.AddTrackingJob(job, onObserveChanged) =\n        if not(this.ContainsTrackingJob(job.identifier)) then\n            this.observedTrackingJobs <- this.observedTrackingJobs @ [job]\n    \n    member this.DeleteTrackingJob(job) =\n        this.observedTrackingJobs <- List.where (fun j -> j <> job) this.observedTrackingJobs    \n    \n    member this.ContainsTrackingJob(name) =\n        List.exists (fun j -> j.identifier = name) this.observedTrackingJobs\n\n\n\ntype LocationTracker = {\n    TrackingService : TrackingService\n    Visualization : TrackVisualization\n    Tracks : Track List\n    Error : string option\n}\n    \n    \n"]}