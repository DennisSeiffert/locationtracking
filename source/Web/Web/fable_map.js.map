{"version":3,"sources":["../fable_map.fsx"],"names":[],"mappings":"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","file":"fable_map.js","sourcesContent":["#r \"node_modules/fable-core/Fable.Core.dll\"\n#r \"node_modules/fable-powerpack/Fable.PowerPack.dll\"\n#r \"node_modules/fable-react/Fable.React.dll\"\n#r \"node_modules/fable-redux/Fable.Redux.dll\"\n#r \"node_modules/fable-reactredux/Fable.ReactRedux.dll\"\n#r \"node_modules/fable-reduxthunk/Fable.ReduxThunk.dll\"\n#load \"fable_domainModel.fsx\"\nopen Fable.Core\nopen Fable.Import\nopen System\nopen Fable.Core.JsInterop\nmodule R = Fable.Helpers.React\nopen R.Props\nopen Fable_domainModel\nopen Fable.Helpers.ReactRedux\n\ntype GeoOptions = {\n  enableHighAccuracy: bool; \n  maximumAge        : int; \n  timeout           : int;\n}\n\nlet defaultGeoOptions = {enableHighAccuracy = true; maximumAge = 60000; timeout = 20000 }\n\n[<Emit(\"google.maps.MapTypeId.TERRAIN\")>]\nlet terrain() : obj = \n    failwith \"JS only\"\n\n[<Emit(\"google.maps.NavigationControlStyle.SMALL\")>]\nlet small() : obj = \n    failwith \"JS only\"\n\ntype GoogleMapPoint = { Latitude : double; Longitude : double }\n\n[<Emit(\"new google.maps.LatLng($0, $1)\")>]\nlet LatLng(lat: double) (lng:double): GoogleMapPoint =\n    { Latitude = lat; Longitude = lng }\n\n[<Emit(\"new google.maps.LatLngBounds ()\")>]\nlet GooglePointBounds() : obj = \n    failwith \"JS only\"\n\n[<Emit(\"new google.maps.Polyline ({path: $0, strokeColor: \\\"#FF00AA\\\", strokeOpacity: .7, strokeWeight: 4})\")>]\nlet GooglePolyline (points : GoogleMapPoint[]) : obj = \n    failwith \"JS only\"\n\ntype googleMapMarkerIcon = {\n          path: string\n          fillColor: string\n          fillOpacity: float\n          scale: int\n          strokeColor: string\n          strokeWeight: int\n        };\n\nlet markerIcon = {\n          path = \"M-18 -30.08C-18 -43.85 16.45 -55 58.95 -55C101.45 -55 135.9 -43.85 135.9 -30.08C135.9 -16.32 101.45 -5.16 58.96 -5.16C48.63 -5.16 38.78 -5.82 29.79 -7.01C27.89 -6.57 18.4 -4.37 1.31 -0.39L5.74 -12.09C-10.09 -19.37 -18 -25.37 -18 -30.08Z\"\n          fillColor = \"white\"\n          fillOpacity = 0.4\n          scale = 1\n          strokeColor = \"black\"\n          strokeWeight = 2\n        }\n\n[<Emit(\"new google.maps.Marker({position: new google.maps.LatLng($0, $1),map:$2,label:$3})\")>]\nlet GoogleMarker (latitude, longitude, map, identifier, markerIcon : googleMapMarkerIcon) : obj = jsNative\n\n[<Emit(\"new google.maps.Map($0, $1)\")>]\nlet GoogleMap(mapHolder:obj) (options:obj) : obj = \n    failwith \"JS only\"\n\n\ntype [<Pojo>] MapViewModel  =\n    { Track : List<TrackingPoint>\n      ObservedTrackingJobs : List<TrackingJob>\n      trackMarkerPosition : TrackingPoint option\n    }\n\ntype [<Pojo>] MapState = { map : obj option; polyLineOfTrack : obj option; needsAnUpdate : bool; markers : List<obj>; trackMarker : obj}\n\ntype MapView(props) =\n    inherit React.Component<MapViewModel, MapState>(props)\n    do base.setInitState({ \n                            map = None  \n                            polyLineOfTrack = None\n                            needsAnUpdate = true\n                            markers = List.Empty\n                            trackMarker = None\n                        })    \n    member val mapHolder = R.div [ ClassName \"jumbotron\" \n                                   Style [\n                                       PaddingTop \"0px\"\n                                       PaddingBottom \"0px\"\n                                       Height \"400px\"\n                                   ]\n                                    ] [ ]    \n\n    member this.componentDidMount (_) =\n        this.Initialize()\n\n    member this.componentDidUpdate(prevState, actualState) =\n        match this.state.map with    \n            | Some map -> \n                    this.showTrack()\n                    //this.showMarkers()\n            | _ -> ignore() \n\n    member this.componentWillReceiveProps(nextProps : MapViewModel) = \n        if this.state.map <> None then \n            let markers = nextProps.ObservedTrackingJobs |> List.map (fun i ->                                                                \n                                                                match List.tryFind (fun e -> string e?title = i.identifier) this.state.markers with\n                                                                            | Some marker ->                                                                                \n                                                                                marker?setPosition(LatLng i.latitude i.longitude) |> ignore                                                                        \n                                                                                marker                                                                                \n                                                                            | None -> GoogleMarker(i.latitude, i.longitude, this.state.map, i.identifier, markerIcon)                                                                \n                                                                )\n            if nextProps.trackMarkerPosition.IsSome then\n                this.state.trackMarker?setPosition(LatLng nextProps.trackMarkerPosition.Value.latitude nextProps.trackMarkerPosition.Value.longitude) |> ignore\n                this.state.trackMarker?setLabel(String.Format(\"{0} Ã¼. N.N\\n{1} km/h\\n{2} km\", \n                                                    Math.Round(nextProps.trackMarkerPosition.Value.elevation, 2), \n                                                    Math.Round(nextProps.trackMarkerPosition.Value.speed *3.6, 2),\n                                                    Math.Round(nextProps.trackMarkerPosition.Value.distanceCovered / 1000.0), 1)) |> ignore\n            this.setState({ this.state with needsAnUpdate = true; markers = markers })\n\n    member this.showMarkers() = \n        if this.state.needsAnUpdate && not(List.isEmpty this.state.markers) then\n            let firstmarker = this.state.markers.[0]\n            this.state.map?panTo(firstmarker?position) |> ignore\n    member this.showTrack() =     \n        if this.state.needsAnUpdate && not(List.isEmpty this.props.Track) then\n            if this.state.polyLineOfTrack <> None then\n                this.state.polyLineOfTrack?setMap(null) |> ignore\n\n            let bounds = GooglePointBounds()\n            let googleMapPoints = List.map (fun p -> \n                                                    let point = LatLng p.latitude p.longitude\n                                                    bounds?extend(point) |> ignore                                                \n                                                    point\n                                                ) (this.props.Track |> List.rev)\n            \n            let polyLine = GooglePolyline(Array.ofList googleMapPoints)            \n            polyLine?setMap(this.state.map) |> ignore\n            this.state.map?fitBounds(bounds) |> ignore            \n\n            this.setState({ this.state with polyLineOfTrack = Some polyLine\n                                            needsAnUpdate = false })        \n        ()\n        \n        \n\n//     function showTrack(track){\n//     if (map === undefined) return;\n\n//     var points = [];\n// \tvar bounds = new google.maps.LatLngBounds ();\n// \t$(track.trackingpoints).each(function() {\n// \t  var lat = this.latitude;\n// \t  var lon = this.longitude;      \n// \t  var p = new google.maps.LatLng(lat, lon);\n// \t  points.push(p);\n// \t  bounds.extend(p);\n// \t});\n//     // reverse order to begin with first tracking point at index 0\n//     points = points.reverse();\n//     //geoPoints = geoPoints.reverse();\n\n//     currentTrack = new TrackViewModel(track.trackingpoints);\n//     currentTrack.assignElevationMarker(new google.maps.Marker({position: new google.maps.LatLng(0, 0),map:map,title:\"Elevation Marker\"}));    \n//     currentTrack.calculate();\n\n// \tvar poly = new google.maps.Polyline({\n// \t  // use your own style here\n// \t  path: points,\n// \t  strokeColor: \"#FF00AA\",\n// \t  strokeOpacity: .7,\n// \t  strokeWeight: 4\n// \t});\t\n// \tpoly.setMap(map);\t\t\n// \tmap.fitBounds(bounds);\n\n//     displayPathElevation(points, map, currentTrack)\n// }    \n\n    member this.Initialize() =\n        let initialLatLng = LatLng (0.0) (0.0)\n        let options = createObj [\n                            \"center\" ==> initialLatLng\n                            \"zoom\" ==> 14\n                            \"mapTypeId\" ==>  terrain() //google.maps.MapTypeId.TERRAIN\n                            \"mapTypeControl\" ==> true\n                            \"navigationControlOptions\" ==> createObj \n                                                [\"style\" ==>  small()] //google.maps.NavigationControlStyle.SMALL\n                            ]\n\n        let map = GoogleMap (Browser.document.getElementsByClassName(\"jumbotron\").[0]) (options)\n        let trackMarker = GoogleMarker(0.0, 0.0, map, \"track marker\", markerIcon)\n        this.setState({map = Some map; polyLineOfTrack = None; needsAnUpdate = true; markers = List.Empty; trackMarker = trackMarker })\n    \n    member this.render () =                 \n        this.mapHolder\n\nlet private mapStateToProps (state : LocationTracker) (ownprops : MapViewModel) =\n    { ownprops with\n        Track = List.ofArray state.Visualization.Points\n        ObservedTrackingJobs = state.TrackingService.observedTrackingJobs   \n        trackMarkerPosition = state.Visualization.LastKnownPosition     \n    }\n// let private mapDispatchToProps (dispatch : ReactRedux.Dispatcher) ownprops =\n//     { ownprops with\n//         onLoadTracks = fun () -> dispatch <| asThunk (Backend.getAllTracks)   \n//         onLoadTrackingPoints = fun(start, ``end``, trackName) -> asThunk (Backend.loadTrackingPoints(start, ``end``, trackName)) |> dispatch\n//     }\n\nlet private setDefaultProps (ownprops : MapViewModel) =\n    { ownprops with\n         Track = List.Empty\n         ObservedTrackingJobs = List.Empty  \n         trackMarkerPosition = Some {\n                                    latitude = 9.9\n                                    longitude = 5.9\n                                    timestamputc = DateTime.Now\n                                    speed = 34.9\n                                    distanceCovered = 0.0\n                                    distance = 32300.9\n                                    index = 1\n                                    elevation = 32.3\n                               }       \n    }         \n\nlet createMapViewComponent =\n    createConnector ()\n    |> withStateMapper mapStateToProps    \n    |> withProps setDefaultProps\n    |> buildComponent<MapView, _, _, _>"]}